<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether Tools | Ultimate Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Light Theme */
            --bg-color: #f0f2f5;
            --sidebar-bg: rgba(255, 255, 255, 0.7);
            --card-bg: rgba(255, 255, 255, 0.55);
            --text-main: #2d3436;
            --text-muted: #636e72;
            --accent: #6c5ce7;
            --accent-grad: linear-gradient(135deg, #6c5ce7, #a29bfe);
            --glass-border: 1px solid rgba(255, 255, 255, 0.8);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            --sidebar-width: 260px;
        }

        body.dark-mode {
            /* Dark Theme */
            --bg-color: #0f0c29;
            --sidebar-bg: rgba(20, 20, 30, 0.6);
            --card-bg: rgba(30, 30, 40, 0.6);
            --text-main: #dfe6e9;
            --text-muted: #b2bec3;
            --accent: #00cec9;
            --accent-grad: linear-gradient(135deg, #00cec9, #81ecec);
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
            transition: background 0.3s, color 0.3s, border-color 0.3s;
        }

        body {
            background: var(--bg-color);
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-size: 200% 200%;
            animation: aurora 20s infinite alternate;
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; 
            display: flex;
        }
        
        body.light-mode {
             background-image: 
                radial-gradient(at 40% 20%, hsla(28,100%,74%,1) 0, transparent 50%), 
                radial-gradient(at 80% 0%, hsla(189,100%,56%,1) 0, transparent 50%), 
                radial-gradient(at 0% 50%, hsla(355,100%,93%,1) 0, transparent 50%);
        }

        @keyframes aurora {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: var(--glass-border);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 100;
            position: relative;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 40px;
            background: var(--accent-grad);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-item {
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            color: var(--text-muted);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: var(--accent);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transform: translateX(5px);
        }
        .nav-item i { width: 20px; text-align: center; }

        .sidebar-footer { margin-top: auto; }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
            scroll-behavior: smooth;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 30px;
        }

        .greeting h1 { font-size: 2.5rem; margin-bottom: 5px; }
        .editable-name {
            border-bottom: 2px dashed var(--text-muted);
            cursor: text;
            transition: 0.2s;
        }
        .editable-name:focus {
            border-bottom: 2px solid var(--accent);
            outline: none;
            color: var(--accent);
        }

        .date-display { text-align: right; color: var(--text-muted); }
        .time-large {
            font-size: 3rem;
            font-weight: 700;
            color: var(--text-main);
            line-height: 1;
        }

        /* --- GRID SYSTEM (Responsive) --- */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        /* CARD STYLES */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: var(--glass-border);
            border-radius: 24px;
            padding: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            animation: slideUp 0.5s ease;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(150,150,150,0.1);
            padding-bottom: 12px;
        }

        /* --- WEATHER & AQI DETAILS --- */
        .weather-search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        .weather-top-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        .weather-icon-large {
            width: 100px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
            animation: float 3s ease-in-out infinite;
        }
        .weather-temp-large {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--text-main);
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.95rem;
        }
        .detail-row span:first-child { color: var(--text-muted); }
        .detail-row span:last-child { font-weight: 600; color: var(--text-main); }
        
        .aqi-header-large { text-align: center; margin-bottom: 15px; }
        .aqi-score { font-size: 2.5rem; font-weight: bold; display: block; }
        .aqi-status {
            padding: 4px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* --- ALARM CLOCK (NEW) --- */
        .alarm-inputs {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }
        .alarm-inputs input {
            width: 70px;
            text-align: center;
            font-size: 1.5rem;
            padding: 10px;
        }
        .alarm-inputs span { font-size: 2rem; font-weight: bold; }
        .alarm-status {
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            color: var(--accent);
            min-height: 20px;
        }

        /* --- CALENDAR (NEW) --- */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
            margin-top: 10px;
        }
        .cal-day-name { font-weight: bold; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px;}
        .cal-day {
            padding: 8px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: default;
        }
        .cal-day.today {
            background: var(--accent-grad);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(108, 92, 231, 0.4);
        }

        /* --- CALCULATOR --- */
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        .calc-display {
            grid-column: span 4;
            background: rgba(0,0,0,0.2);
            color: var(--text-main);
            padding: 15px;
            border-radius: 10px;
            text-align: right;
            font-size: 1.5rem;
            margin-bottom: 10px;
            height: 50px;
        }
        .calc-btn {
            background: rgba(255,255,255,0.1);
            border: var(--glass-border);
            color: var(--text-main);
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.1s;
        }
        .calc-btn:active { transform: scale(0.95); }
        .calc-btn.op { background: rgba(108, 92, 231, 0.2); color: var(--accent); }
        .calc-btn.eq { background: var(--accent-grad); color: white; grid-column: span 2; }

        /* --- FOCUS / POMODORO --- */
        .pomo-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
        }
        .timer-circle { position: relative; width: 150px; height: 150px; }
        .timer-circle svg { width: 150px; height: 150px; transform: rotate(-90deg); }
        .timer-circle circle { fill: none; stroke-width: 8; stroke-linecap: round; }
        .circle-bg { stroke: rgba(255,255,255,0.1); }
        .circle-progress { 
            stroke: var(--accent); 
            stroke-dasharray: 440; 
            stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s linear;
        }
        .timer-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 700;
        }
        .pomo-controls { margin-top: 20px; display: flex; gap: 10px; }

        /* --- STICKY NOTES --- */
        .note-area {
            width: 100%;
            height: 150px;
            background: transparent;
            border: none;
            resize: none;
            color: var(--text-main);
            font-size: 1rem;
            outline: none;
            line-height: 1.5;
        }
        
        /* Inputs & Buttons */
        input, select {
            width: 100%;
            padding: 10px 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.2);
            color: var(--text-main);
            outline: none;
            font-family: inherit;
        }
        button.primary-btn {
            background: var(--accent-grad);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        button.secondary-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: var(--text-main);
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            white-space: nowrap;
        }
        button:hover { transform: translateY(-2px); }
        button:active { transform: translateY(0); }

        /* --- PAGES/TABS LOGIC --- */
        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.4s; }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* --- RESPONSIVE DESIGN --- */
        
        /* Tablet & Mobile */
        @media (max-width: 900px) {
            .bento-grid { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        }

        /* Mobile Only */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; height: auto; min-height: 100vh; }
            
            /* Bottom Navigation Bar for Mobile */
            .sidebar { 
                width: 100%; 
                flex-direction: row; 
                padding: 10px 20px; 
                position: fixed; 
                bottom: 0; 
                left: 0;
                height: 70px;
                border-top: var(--glass-border);
                border-right: none;
                justify-content: space-around;
                align-items: center;
                background: rgba(255, 255, 255, 0.9); /* More opaque for mobile nav */
                box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            }
            body.dark-mode .sidebar { background: rgba(20, 20, 30, 0.9); }

            .logo, .sidebar-footer, .nav-item span { display: none; }
            .nav-links { flex-direction: row; width: 100%; justify-content: space-around; gap: 0; }
            .nav-item { padding: 12px; font-size: 1.4rem; border-radius: 50%; }
            .nav-item:hover { transform: none; }
            
            /* Main Content Adjustments */
            .main-content { padding: 20px; padding-bottom: 90px; } /* Extra padding for bottom nav */
            .header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .date-display { text-align: left; }
            
            /* Grid becomes single column */
            .bento-grid { grid-template-columns: 1fr; }
            
            /* Adjust large text */
            .weather-temp-large { font-size: 3rem; }
            .time-large { font-size: 2.5rem; }
        }
    </style>
</head>
<body class="light-mode">

    <nav class="sidebar">
        <div class="logo">
            <i class="fa-solid fa-atom"></i> Aether
        </div>
        <ul class="nav-links">
            <li class="nav-item active" onclick="showPage('dashboard')">
                <i class="fa-solid fa-layer-group"></i> <span>Dashboard</span>
            </li>
            <li class="nav-item" onclick="showPage('tools')">
                <i class="fa-solid fa-screwdriver-wrench"></i> <span>Tools</span>
            </li>
            <li class="nav-item" onclick="showPage('notes')">
                <i class="fa-regular fa-note-sticky"></i> <span>Notes</span>
            </li>
        </ul>
        <div class="sidebar-footer">
            <div class="nav-item" id="themeToggle">
                <i class="fa-solid fa-moon"></i> <span>Theme</span>
            </div>
        </div>
    </nav>

    <main class="main-content">
        
        <header class="header">
            <div class="greeting">
                <p style="color: var(--accent); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Overview</p>
                <h1>Good <span id="timeGreeting">Morning</span>, <span class="editable-name" id="userName" contenteditable="true">User</span>.</h1>
            </div>
            <div class="date-display">
                <div class="time-large" id="clock">12:00</div>
                <div id="date">Monday, Nov 26</div>
            </div>
        </header>

        <div id="dashboard" class="page-section active">
            
            <div class="weather-search-container">
                <input type="text" id="cityInput" placeholder="Enter City Name...">
                <button class="primary-btn" onclick="getWeather()"><i class="fa-solid fa-search"></i> Search</button>
                <button class="secondary-btn" onclick="getLocationWeather()"><i class="fa-solid fa-location-dot"></i> Location</button>
            </div>

            <div class="bento-grid">
                
                <div class="card">
                    <h2>Current Weather <i class="fa-solid fa-cloud-sun"></i></h2>
                    
                    <div class="weather-top-section">
                        <img id="weatherIcon" src="" alt="icon" class="weather-icon-large">
                        <div class="weather-temp-large" id="temp">--°C</div>
                        <div id="condition" style="font-size: 1.2rem; text-transform: capitalize; opacity: 0.8;">Condition</div>
                        <div style="font-size: 1rem; margin-top: 5px; opacity: 0.6;"><i class="fa-solid fa-city"></i> <span id="cityName">--</span></div>
                    </div>

                    <div class="weather-details-list">
                        <div class="detail-row">
                            <span>Humidity</span>
                            <span id="humidity">--%</span>
                        </div>
                        <div class="detail-row">
                            <span>Wind Speed</span>
                            <span id="wind">-- m/s</span>
                        </div>
                        <div class="detail-row">
                            <span>Pressure</span>
                            <span id="pressure">-- hPa</span>
                        </div>
                        <div class="detail-row">
                            <span>Rainfall (1h)</span>
                            <span id="rain">-- mm</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Air Quality Index (AQI) <i class="fa-solid fa-lungs"></i></h2>
                    
                    <div class="aqi-header-large">
                        <div style="font-size: 1rem; opacity: 0.7; margin-bottom: 5px;">AQI Level</div>
                        <span class="aqi-score" id="aqiScore">--</span>
                        <span class="aqi-status" id="aqiStatusText" style="background: #ccc;">Unknown</span>
                    </div>

                    <div class="weather-details-list">
                        <div class="detail-row">
                            <span>PM 2.5</span>
                            <span id="pm25">-- µg/m³</span>
                        </div>
                        <div class="detail-row">
                            <span>PM 10</span>
                            <span id="pm10">-- µg/m³</span>
                        </div>
                        <div class="detail-row">
                            <span>CO (Carbon Monoxide)</span>
                            <span id="co">-- µg/m³</span>
                        </div>
                        <div class="detail-row">
                            <span>NO2 (Nitrogen Dioxide)</span>
                            <span id="no2">-- µg/m³</span>
                        </div>
                        <div class="detail-row">
                            <span>O3 (Ozone)</span>
                            <span id="o3">-- µg/m³</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Zen Focus <i class="fa-solid fa-bullseye"></i></h2>
                    <div class="pomo-wrapper">
                        <div class="timer-circle">
                            <svg>
                                <circle class="circle-bg" cx="75" cy="75" r="70"></circle>
                                <circle class="circle-progress" id="pomoRing" cx="75" cy="75" r="70"></circle>
                            </svg>
                            <div class="timer-text" id="pomoTime">25:00</div>
                        </div>
                        <div class="pomo-controls">
                            <button class="primary-btn" onclick="togglePomo()" id="pomoBtn"><i class="fa-solid fa-play"></i></button>
                            <button class="secondary-btn" onclick="resetPomo()"><i class="fa-solid fa-rotate-left"></i></button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Quick Tasks <i class="fa-solid fa-check-double"></i></h2>
                    <div style="display: flex; gap: 5px; margin-bottom: 15px;">
                        <input type="text" id="taskInput" placeholder="Add task...">
                        <button class="primary-btn" onclick="addTask()"><i class="fa-solid fa-plus"></i></button>
                    </div>
                    <ul id="taskList" style="list-style: none; overflow-y: auto; max-height: 250px;">
                        </ul>
                </div>

            </div>
        </div>

        <div id="tools" class="page-section">
            <div class="bento-grid">
                
                <div class="card">
                    <h2>Alarm Clock <i class="fa-regular fa-clock"></i></h2>
                    <div style="text-align: center; margin-top: 20px;">
                        <div class="alarm-inputs">
                            <input type="number" id="alarmH" min="1" max="12" placeholder="HH">
                            <span>:</span>
                            <input type="number" id="alarmM" min="0" max="59" placeholder="MM">
                            <select id="alarmAP" style="width: 80px;">
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                            <button class="primary-btn" onclick="setAlarm()">Set Alarm</button>
                            <button class="secondary-btn" onclick="clearAlarm()">Clear</button>
                        </div>
                        <p id="alarmStatus" class="alarm-status">No alarm set</p>
                    </div>
                </div>

                <div class="card">
                    <h2>Calendar <i class="fa-regular fa-calendar-days"></i></h2>
                    <div id="currentMonthYear" style="text-align: center; font-weight: bold; margin: 10px 0; font-size: 1.2rem; color: var(--accent);">November 2024</div>
                    <div class="calendar-grid">
                        <div class="cal-day-name">Sun</div>
                        <div class="cal-day-name">Mon</div>
                        <div class="cal-day-name">Tue</div>
                        <div class="cal-day-name">Wed</div>
                        <div class="cal-day-name">Thu</div>
                        <div class="cal-day-name">Fri</div>
                        <div class="cal-day-name">Sat</div>
                        </div>
                    <div id="calendarDays" class="calendar-grid"></div>
                </div>

                <div class="card" style="grid-row: span 2;">
                    <h2>Calculator <i class="fa-solid fa-calculator"></i></h2>
                    <div class="calc-grid">
                        <div class="calc-display" id="calcDisplay">0</div>
                        <button class="calc-btn op" onclick="calcClear()">C</button>
                        <button class="calc-btn op" onclick="calcInput('/')">÷</button>
                        <button class="calc-btn op" onclick="calcInput('*')">×</button>
                        <button class="calc-btn op" onclick="calcDel()"><i class="fa-solid fa-delete-left"></i></button>
                        <button class="calc-btn" onclick="calcInput('7')">7</button>
                        <button class="calc-btn" onclick="calcInput('8')">8</button>
                        <button class="calc-btn" onclick="calcInput('9')">9</button>
                        <button class="calc-btn op" onclick="calcInput('-')">-</button>
                        <button class="calc-btn" onclick="calcInput('4')">4</button>
                        <button class="calc-btn" onclick="calcInput('5')">5</button>
                        <button class="calc-btn" onclick="calcInput('6')">6</button>
                        <button class="calc-btn op" onclick="calcInput('+')">+</button>
                        <button class="calc-btn" onclick="calcInput('1')">1</button>
                        <button class="calc-btn" onclick="calcInput('2')">2</button>
                        <button class="calc-btn" onclick="calcInput('3')">3</button>
                        <button class="calc-btn eq" onclick="calcResult()">=</button>
                        <button class="calc-btn" onclick="calcInput('0')" style="grid-column: span 2;">0</button>
                        <button class="calc-btn" onclick="calcInput('.')">.</button>
                    </div>
                </div>

                <div class="card">
                    <h2>Stopwatch <i class="fa-solid fa-stopwatch"></i></h2>
                    <div style="text-align: center; margin-top: 30px;">
                        <div id="swDisplay" style="font-size: 3.5rem; font-weight: 700; font-variant-numeric: tabular-nums;">00:00:00</div>
                        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
                            <button class="primary-btn" onclick="startSw()">Start</button>
                            <button class="secondary-btn" onclick="stopSw()">Stop</button>
                            <button class="secondary-btn" onclick="resetSw()">Reset</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="notes" class="page-section">
            <div class="card" style="height: 70vh;">
                <h2>Sticky Notes <i class="fa-solid fa-pen-nib"></i> <span style="font-size: 0.8rem; font-weight: 400; opacity: 0.6;">(Auto-saved)</span></h2>
                <textarea class="note-area" id="stickyNote" placeholder="Type your thoughts here..." style="height: 100%;"></textarea>
            </div>
        </div>

    </main>

    <script>
        // --- 1. THEME & NAV ---
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        if(localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-mode');
            themeToggle.classList.remove('light-mode');
        }

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            body.classList.toggle('light-mode'); 
            const isDark = body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // --- 2. USER & CLOCK ---
        const userNameEl = document.getElementById('userName');
        if(localStorage.getItem('aetherUser')) {
            userNameEl.textContent = localStorage.getItem('aetherUser');
        }
        userNameEl.addEventListener('input', () => {
            localStorage.setItem('aetherUser', userNameEl.textContent);
        });

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('date').textContent = now.toLocaleDateString([], {weekday: 'long', month: 'long', day: 'numeric'});
            
            const hr = now.getHours();
            let greet = "Evening";
            if(hr < 12) greet = "Morning";
            else if(hr < 18) greet = "Afternoon";
            document.getElementById('timeGreeting').textContent = greet;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- 3. WEATHER (Detailed) ---
        const API_KEY = '400fe231827dcfb7820a4bae569869d1';
        const cityInput = document.getElementById('cityInput');

        async function fetchWeather(query, lat = null, lon = null) {
            try {
                let url = lat && lon ? 
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}` : 
                    `https://api.openweathermap.org/data/2.5/weather?q=${query}&units=metric&appid=${API_KEY}`;

                const res = await fetch(url);
                if(!res.ok) throw new Error("City not found");
                const data = await res.json();
                
                // Weather
                document.getElementById('temp').textContent = Math.round(data.main.temp) + "°C";
                document.getElementById('cityName').textContent = data.name;
                document.getElementById('condition').textContent = data.weather[0].description;
                document.getElementById('weatherIcon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
                
                document.getElementById('humidity').textContent = data.main.humidity + "%";
                document.getElementById('wind').textContent = data.wind.speed + " m/s";
                document.getElementById('pressure').textContent = data.main.pressure + " hPa";
                const rainfall = data.rain ? (data.rain['1h'] || 0) : 0;
                document.getElementById('rain').textContent = rainfall > 0 ? rainfall + " mm" : "--";

                localStorage.setItem('aetherCity', data.name);
                fetchAQI(data.coord.lat, data.coord.lon);

            } catch (err) { alert("Error: " + err.message); }
        }

        async function fetchAQI(lat, lon) {
            try {
                const url = `https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`;
                const res = await fetch(url);
                const data = await res.json();
                const aqiData = data.list[0];

                const score = aqiData.main.aqi;
                const statusMap = {
                    1: { text: "Good", color: "#00b894" },
                    2: { text: "Fair", color: "#ffeaa7" },
                    3: { text: "Moderate", color: "#fdcb6e" },
                    4: { text: "Poor", color: "#e17055" },
                    5: { text: "Very Poor", color: "#d63031" }
                };
                
                const status = statusMap[score];
                document.getElementById('aqiScore').textContent = score;
                const statusEl = document.getElementById('aqiStatusText');
                statusEl.textContent = status.text;
                statusEl.style.background = status.color;
                if(score > 2) statusEl.style.color = "#2d3436"; else statusEl.style.color = "white";

                document.getElementById('pm25').textContent = aqiData.components.pm2_5 + " µg/m³";
                document.getElementById('pm10').textContent = aqiData.components.pm10 + " µg/m³";
                document.getElementById('co').textContent = aqiData.components.co + " µg/m³";
                document.getElementById('no2').textContent = aqiData.components.no2 + " µg/m³";
                document.getElementById('o3').textContent = aqiData.components.o3 + " µg/m³";

            } catch (err) { console.error("AQI Error", err); }
        }

        function getWeather() { if(cityInput.value) fetchWeather(cityInput.value); }
        function getLocationWeather() {
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    fetchWeather(null, pos.coords.latitude, pos.coords.longitude);
                }, () => alert("Location access denied."));
            }
        }
        const savedCity = localStorage.getItem('aetherCity') || 'London';
        fetchWeather(savedCity);

        // --- 4. ALARM CLOCK ---
        let alarmInterval, alarmTime;
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playBeep() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'square';
            oscillator.frequency.value = 800;
            gainNode.gain.value = 0.1;
            oscillator.start();
            setTimeout(() => oscillator.stop(), 200);
        }

        function setAlarm() {
            const h = parseInt(document.getElementById('alarmH').value);
            const m = parseInt(document.getElementById('alarmM').value);
            const ap = document.getElementById('alarmAP').value;

            if(!h || isNaN(m)) { alert("Invalid Time"); return; }
            if(audioCtx.state === 'suspended') audioCtx.resume();

            let targetH = h;
            if(ap === 'PM' && h !== 12) targetH += 12;
            if(ap === 'AM' && h === 12) targetH = 0;

            const now = new Date();
            alarmTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), targetH, m, 0);
            if(alarmTime <= now) alarmTime.setDate(alarmTime.getDate() + 1);

            document.getElementById('alarmStatus').textContent = `Alarm set for ${h}:${String(m).padStart(2,'0')} ${ap}`;
            
            clearInterval(alarmInterval);
            alarmInterval = setInterval(() => {
                const current = new Date();
                if(current >= alarmTime) {
                    clearInterval(alarmInterval);
                    document.getElementById('alarmStatus').textContent = "ALARM RINGING!";
                    
                    // Ring 5 times
                    let count = 0;
                    const ringLoop = setInterval(() => {
                        playBeep();
                        count++;
                        if(count > 10) clearInterval(ringLoop);
                    }, 500);
                }
            }, 1000);
        }

        function clearAlarm() {
            clearInterval(alarmInterval);
            document.getElementById('alarmStatus').textContent = "No alarm set";
        }

        // --- 5. CALENDAR GENERATOR ---
        function renderCalendar() {
            const date = new Date();
            const month = date.getMonth();
            const year = date.getFullYear();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById('currentMonthYear').textContent = `${monthNames[month]} ${year}`;
            
            const calendarEl = document.getElementById('calendarDays');
            calendarEl.innerHTML = '';
            
            // Empty slots
            for(let i=0; i<firstDay; i++) {
                const div = document.createElement('div');
                calendarEl.appendChild(div);
            }
            
            // Days
            for(let i=1; i<=daysInMonth; i++) {
                const div = document.createElement('div');
                div.className = 'cal-day';
                if(i === date.getDate()) div.classList.add('today');
                div.textContent = i;
                calendarEl.appendChild(div);
            }
        }
        renderCalendar();

        // --- 6. CALCULATOR & STOPWATCH ---
        let calcVal = "";
        const calcDisplay = document.getElementById('calcDisplay');
        function calcInput(v) { calcVal += v; calcDisplay.textContent = calcVal; }
        function calcClear() { calcVal = ""; calcDisplay.textContent = "0"; }
        function calcDel() { calcVal = calcVal.slice(0, -1); calcDisplay.textContent = calcVal || "0"; }
        function calcResult() { try { calcVal = eval(calcVal).toString(); calcDisplay.textContent = calcVal; } catch { calcDisplay.textContent = "Error"; calcVal = ""; } }

        let swInt, swTime=0;
        function startSw() { if(!swInt) { let start = Date.now() - swTime; swInt = setInterval(() => { swTime = Date.now() - start; document.getElementById('swDisplay').textContent = new Date(swTime).toISOString().slice(11,19); }, 100); } }
        function stopSw() { clearInterval(swInt); swInt=null; }
        function resetSw() { stopSw(); swTime=0; document.getElementById('swDisplay').textContent="00:00:00"; }

        // --- 7. POMODORO ---
        let pomoInterval;
        let isRunning = false;
        let timeLeft = 25 * 60;
        const totalTime = 25 * 60;
        const ring = document.getElementById('pomoRing');
        const circumference = 2 * Math.PI * 70;

        function updateRing() {
            const offset = circumference - (timeLeft / totalTime) * circumference;
            ring.style.strokeDashoffset = offset;
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('pomoTime').textContent = `${m}:${s}`;
        }

        function togglePomo() {
            const btn = document.getElementById('pomoBtn');
            if(isRunning) { clearInterval(pomoInterval); btn.innerHTML = '<i class="fa-solid fa-play"></i>'; } 
            else { pomoInterval = setInterval(() => { if(timeLeft > 0) { timeLeft--; updateRing(); } else { clearInterval(pomoInterval); alert("Zen Session Complete."); resetPomo(); } }, 1000); btn.innerHTML = '<i class="fa-solid fa-pause"></i>'; }
            isRunning = !isRunning;
        }
        function resetPomo() { clearInterval(pomoInterval); isRunning = false; timeLeft = 25 * 60; updateRing(); document.getElementById('pomoBtn').innerHTML = '<i class="fa-solid fa-play"></i>'; }

        // --- 8. TASKS & NOTES ---
        const taskList = document.getElementById('taskList');
        const taskIn = document.getElementById('taskInput');
        let tasks = JSON.parse(localStorage.getItem('aetherTasks')) || [];
        function renderTasks() {
            taskList.innerHTML = '';
            tasks.forEach((t, i) => {
                const li = document.createElement('li');
                li.style.padding = '10px 0';
                li.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                li.style.display = 'flex';
                li.style.justifyContent = 'space-between';
                li.innerHTML = `<span style="${t.done ? 'text-decoration: line-through; opacity: 0.5;' : ''}">${t.text}</span><div><i class="fa-solid fa-check" onclick="toggleTask(${i})" style="cursor:pointer; margin-right:10px; color: var(--accent);"></i><i class="fa-solid fa-trash" onclick="delTask(${i})" style="cursor:pointer; color: #ff7675;"></i></div>`;
                taskList.appendChild(li);
            });
            localStorage.setItem('aetherTasks', JSON.stringify(tasks));
        }
        function addTask() { if(taskIn.value) { tasks.push({text: taskIn.value, done: false}); taskIn.value = ''; renderTasks(); } }
        function toggleTask(i) { tasks[i].done = !tasks[i].done; renderTasks(); }
        function delTask(i) { tasks.splice(i, 1); renderTasks(); }
        renderTasks();

        const noteArea = document.getElementById('stickyNote');
        if(localStorage.getItem('aetherNote')) noteArea.value = localStorage.getItem('aetherNote');
        noteArea.addEventListener('input', () => localStorage.setItem('aetherNote', noteArea.value));
    </script>
</body>
</html>
